!function(n){var i={};function s(e){if(i[e])return i[e].exports;var t=i[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,s),t.l=!0,t.exports}s.m=n,s.c=i,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(n,i,function(e){return t[e]}.bind(null,i));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=44)}([function(e){e.exports=JSON.parse('{"global":{"pause":"Escape"},"player1":{"up":"ArrowUp","right":"ArrowRight","down":"ArrowDown","left":"ArrowLeft","stop":"Space"},"player2":{"up":"KeyW","right":"KeyD","down":"KeyS","left":"KeyA","stop":"ControlLeft"}}')},function(e,t,n){e.exports=n.p+"images/stone_isolated530604dccd1027bb334d370e760672af.png"},function(e,t,n){e.exports=n.p+"images/stone_connectedLeft03e139b568e980c526f258a3fdbe2db3.png"},function(e,t,n){e.exports=n.p+"images/stone_connectedRight9630d0eca64a83f89c85a677b7ed0591.png"},function(e,t,n){e.exports=n.p+"images/stone_connectedTop425f2bf74a3c530d5145f009797caeef.png"},function(e,t,n){e.exports=n.p+"images/stone_connectedBottome35dac4c9000db1c2bf2b433503548ac.png"},function(e,t,n){e.exports=n.p+"images/stone_betweenHorizontal1bcac0e006e6ca70e9cdb1de5d239275.png"},function(e,t,n){e.exports=n.p+"images/stone_betweenVertical0fa8ed46940ffb0b40e92112c3bb5117.png"},function(e,t,n){e.exports=n.p+"images/stone_connectedBottomAndRight8853bd17731c3da6469566ae81ac86eb.png"},function(e,t,n){e.exports=n.p+"images/stone_connectedBottomAndLeft2d0d1517c16a635f1cf88794aea50b78.png"},function(e,t,n){e.exports=n.p+"images/stone_connectedTopAndLefte4f30c376a7d801637aef9b31e930b61.png"},function(e,t,n){e.exports=n.p+"images/stone_connectedTopAndRight0a8ce7f24cb6bb02ecc7760ff51b53d8.png"},function(e,t,n){e.exports=n.p+"images/stone_connectedAllcea47e078b48229b4f5521d0aefc3fa1.png"},function(e,t,n){e.exports=n.p+"images/stone_betweenVertical_connectedLeftb70cfaea10c2845ab31e8b7a0ea7d81e.png"},function(e,t,n){e.exports=n.p+"images/stone_betweenVertical_connectedRight1a92a44c4aa5ed6fedf011e2d48550b3.png"},function(e,t,n){e.exports=n.p+"images/stone_betweenHorizontal_connectedTopb680910a072ca770c146a7da80b5f968.png"},function(e,t,n){e.exports=n.p+"images/stone_betweenHorizontal_connectedBottom0096561effda01952033463a7c317b8c.png"},function(e,t,n){e.exports=n.p+"images/cell4bda028508a52dd3adf210d58377467d.png"},function(e,t,n){e.exports=n.p+"images/player1_anim1_right9bfd7ee41213f2b0d23c74bc007407e0.png"},function(e,t,n){e.exports=n.p+"images/player1_anim2_right93e98b2990c304402f842e201d1bb7bf.png"},function(e,t,n){e.exports=n.p+"images/player1_anim3_right9eca4886517844d4c1a305e07a6f1115.png"},function(e,t,n){e.exports=n.p+"images/player1_anim4_rightfb5bd7c62007dec510cca01da7a899b2.png"},function(e,t,n){e.exports=n.p+"images/player1_anim5_rightf7838ce0a537ad5af948f0456dcbc121.png"},function(e,t,n){e.exports=n.p+"images/player1_anim6_rightec1634d5b0f7c26fae439e1aed6e415b.png"},function(e,t,n){e.exports=n.p+"images/player1_anim1_left74c51faf5445f93500a60b19df0e5a60.png"},function(e,t,n){e.exports=n.p+"images/player1_anim2_leftee23cf4539e17c1d6f1c61faf26ff28f.png"},function(e,t,n){e.exports=n.p+"images/player1_anim3_lefta4c029cb1b495f9e5e7b283ade93f035.png"},function(e,t,n){e.exports=n.p+"images/player1_anim4_left78912436b9af436f1f0a39aa452c5f92.png"},function(e,t,n){e.exports=n.p+"images/player1_anim5_left4b614f7b9a920a93a425f140849dc866.png"},function(e,t,n){e.exports=n.p+"images/player1_anim6_left487edb28d9709968bf913ea3ace284a6.png"},function(e,t,n){e.exports=n.p+"images/player1_stop_left047f294e8721689677ee3d9ba0e09c36.png"},function(e,t,n){e.exports=n.p+"images/player1_stop_right3a87b216056a94be56b079b064e807f5.png"},function(e,t,n){e.exports=n.p+"images/coin1174086130a29db6bd8b68eb8d4ea3944.png"},function(e,t,n){e.exports=n.p+"images/coin21014ba4e51873018ada0e0e85694068e.png"},function(e,t,n){e.exports=n.p+"images/coin3777c81244a45759066080a7ebc97ddc0.png"},function(e,t,n){e.exports=n.p+"images/coin41022d70d9b4eea50c95a7d52baddfe70.png"},function(e,t,n){e.exports=n.p+"images/coin5aa0cd54f2f444f6d5e26cbd797d5085e.png"},function(e,t,n){e.exports=n.p+"images/coin6d2318616b4617445adf4057d29149b13.png"},function(e,t,n){e.exports=n.p+"images/trap136f832c521207ef3736e296742c1406e.png"},function(e,t,n){e.exports=n.p+"images/trap262e702b493194bc9124e141c15fa01c9.png"},function(e,t,n){e.exports=n.p+"images/trap30b734cdd970ea5ee118791a1f9c6354a.png"},function(e,t,n){e.exports=n.p+"images/trap4efecbf66c8494d6f0d7b14957bd8e47f.png"},function(e,t,n){e.exports=n.p+"sounds/coin276507ac96a9c75bc2ab6f40f74a19547.mp3"},function(e,t,n){},function(e,t,n){"use strict";n.r(t);n(43);var i=n(1),s=n.n(i),a=n(2),o=n.n(a),r=n(3),c=n.n(r),p=n(4),h=n.n(p),l=n(5),f=n.n(l),d=n(6),u=n.n(d),m=n(7),b=n.n(m),g=n(8),v=n.n(g),w=n(9),y=n.n(w),S=n(10),C=n.n(S),_=n(11),k=n.n(_),L=n(12),x=n.n(L),I=n(13),j=n.n(I),O=n(14),Y=n.n(O),P=n(15),X=n.n(P),E=n(16),A=n.n(E),G=n(17),z=n.n(G),T=n(18),R=n.n(T),H=n(19),B=n.n(H),F=n(20),D=n.n(F),M=n(21),W=n.n(M),V=n(22),$=n.n(V),q=n(23),N=n.n(q),K=n(24),U=n.n(K),J=n(25),Q=n.n(J),Z=n(26),ee=n.n(Z),te=n(27),ne=n.n(te),ie=n(28),se=n.n(ie),ae=n(29),oe=n.n(ae),re=n(30),ce=n.n(re),pe=n(31),he=n.n(pe),le=n(32),fe=n.n(le),de=n(33),ue=n.n(de),me=n(34),be=n.n(me),ge=n(35),ve=n.n(ge),we=n(36),ye=n.n(we),Se=n(37),Ce=n.n(Se),_e=n(38),ke=n.n(_e),Le=n(39),xe=n.n(Le),Ie=n(40),je=n.n(Ie),Oe=n(41),Ye=n.n(Oe),Pe=n(42),Xe=n.n(Pe);function Ee(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ae(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Ge(e,t,n){return t&&Ae(e.prototype,t),n&&Ae(e,n),e}var ze=new Image;ze.src=s.a;var Te=new Image;Te.src=o.a;var Re=new Image;Re.src=c.a;var He=new Image;He.src=h.a;var Be=new Image;Be.src=f.a;var Fe=new Image;Fe.src=u.a;var De=new Image;De.src=b.a;var Me=new Image;Me.src=v.a;var We=new Image;We.src=y.a;var Ve=new Image;Ve.src=C.a;var $e=new Image;$e.src=k.a;var qe=new Image;qe.src=x.a;var Ne=new Image;Ne.src=j.a;var Ke=new Image;Ke.src=Y.a;var Ue=new Image;Ue.src=X.a;var Je=new Image;Je.src=A.a;var Qe=new Image;Qe.src=z.a;var Ze=new Image;Ze.src=R.a;var et=new Image;et.src=B.a;var tt=new Image;tt.src=D.a;var nt=new Image;nt.src=W.a;var it=new Image;it.src=$.a;var st=new Image;st.src=N.a;var at=new Image;at.src=U.a;var ot=new Image;ot.src=Q.a;var rt=new Image;rt.src=ee.a;var ct=new Image;ct.src=ne.a;var pt=new Image;pt.src=se.a;var ht=new Image;ht.src=oe.a;var lt=new Image;lt.src=ce.a;var ft=new Image;ft.src=he.a;var dt=new Image;dt.src=fe.a;var ut=new Image;ut.src=ue.a;var mt=new Image;mt.src=be.a;var bt=new Image;bt.src=ve.a;var gt=new Image;gt.src=ye.a;var vt=new Image;vt.src=Ce.a;var wt=new Image;wt.src=ke.a;var yt=new Image;yt.src=xe.a;var St=new Image;St.src=je.a;var Ct=new Image;function _t(e,t,n,i,s,a){var o={type:t,id:t+e,visible:!0,material:i,posX:s,posY:a,eventList:[],sprite:null,spriteList:[],animateSpriteCount:0,animateSpeedCount:0,animateSpeed:1,spriteWidth:0,spriteHeight:0,spriteOffsetX:0,spriteOffsetY:0};return o.die=function(){window.Game.removeObject(this)}.bind(o),o.staticAnimate=function(){this.animateSpeedCount===this.animateSpeed?(this.animateSpeedCount=0,this.animateSpriteCount===this.spriteList.length-1?this.animateSpriteCount=0:this.animateSpriteCount+=1,this.sprite=this.spriteList.getSprite(this.animateSpriteCount,this.direction)):this.animateSpeedCount+=1}.bind(o),o.moveAnimate=function(){if(!this.moves)return this.animateSpriteCount=0,this.animateSpeedCount=0,void(this.sprite=this.spriteList.getStopSprite(this.direction));this.animateSpeedCount===this.animateSpeed?(this.animateSpeedCount=0,this.animateSpriteCount===this.spriteList.length-1?this.animateSpriteCount=0:this.animateSpriteCount+=1,this.sprite=this.spriteList.getSprite(this.animateSpriteCount,this.direction)):this.animateSpeedCount+=1}.bind(o),n instanceof Pt?n.default?(o.spriteList=n,o.sprite=n.default[0],o.eventList.push(new Yt("staticAnimate",o.staticAnimate,!1))):(o.spriteList=n,o.sprite=n.right[0],o.eventList.push(new Yt("moveAnimate",o.moveAnimate,!1))):n.length?(o.spriteList=n,o.sprite=n[0]):o.sprite=n,o.addEvent=function(t,e,n,i){i&&(this.eventList=this.eventList.filter(function(e){return e.id!=="event"+t})),this.eventList.push(new Yt(t||this.eventList.length,e,n))}.bind(o),o.addEventToStart=function(t,e,n,i){i&&(this.eventList=this.eventList.filter(function(e){return e.id!=="event"+t})),this.eventList.unshift(new Yt(t||this.eventList.length,e,n))}.bind(o),o.startEvents=function(){var t=[];0<this.eventList.length&&(this.eventList.forEach(function(e){e.func(),e.removable||t.push(e)}),this.eventList=t)}.bind(o),o.checkClash=function(e,t){if(e.id!==this.id){var n,i,s=t/2,a=this.posX-s,o=this.posX+s,r=this.posY-s,c=this.posY+s,p=e.posX-s,h=e.posX+s,l=e.posY-s,f=e.posY+s;if(l<c&&r<f&&a<h&&p<o)if(this.clash(e),e.clash(this),"stone"===this.type)switch(n=this.posX<e.posX?"right":this.posX>e.posX?"left":"one level",i=this.posY<e.posY?"bottom":this.posY>e.posY?"top":"one level",Math.abs(this.posX-e.posX)>Math.abs(this.posY-e.posY)?n:i){case"right":"left"===e.direction&&(e.addEventToStart("stop",e.stopMove,!0),e.posX+=e.speed);break;case"left":"right"===e.direction&&(e.addEventToStart("stop",e.stopMove,!0),e.posX-=e.speed);break;case"bottom":"top"===e.direction&&(e.addEventToStart("stop",e.stopMove,!0),e.posY+=e.speed);break;case"top":"bottom"===e.direction&&(e.addEventToStart("stop",e.stopMove,!0),e.posY-=e.speed)}}}.bind(o),o.clash=function(e){}.bind(o),o}function kt(e,t,n,i,s,a,o){var r=new _t(e,t,n,!0,i,s);return r.hp=a||100,r.direction="top",r.moves=!1,r.speed=o||1,r.spawnPosX=i,r.spawnPosY=s,r.changeDirection=function(t){("left"!==this.direction&&"right"!==this.direction||"left"!==t&&"right"!==t)&&("top"!==this.direction&&"bottom"!==this.direction||"top"!==t&&"bottom"!==t)?this.addEventToStart("tryChangeDirection",function(){var e=window.Game.findCell({object:{posX:r.posX,posY:r.posY},direction:t});r.posX/20%2==1&&r.posY/20%2==1&&e&&0<e.objects.length&&"stone"!==e.objects[0].type&&(r.direction=t,this.removable=!0)},!1,!0):this.direction=t}.bind(r),r.startMove=function(){this.moves=!0}.bind(r),r.stopMove=function(){this.moves=!1}.bind(r),r.move=function(){if(this.moves)switch(this.direction){case"left":this.posX-=this.speed;break;case"right":this.posX+=this.speed;break;case"top":this.posY-=this.speed;break;case"bottom":this.posY+=this.speed}}.bind(r),r}function Lt(e,t,n,i,s){var a=new kt(e,"player",new Pt({left:[at,ot,rt,ct,pt,ht],right:[Ze,et,tt,nt,it,st],stop:{left:lt,right:ft}}),t,n,100,4);return a.nickName=i||"Unamed",a.score=s||0,a.eventList.push(new Yt("move",a.move,!1)),a.spriteWidth=49,a.spriteHeight=53,a.spriteOffsetX=0,a.spriteOffsetY=-6,a.hp=3,a.killed=!1,a.rebornTime=10,a.rebornCounter=0,a.reborn=function(e,t){this.rebornCounter=this.rebornTime-Math.floor((new Date-e)/1e3),(new Date-e)/1e3>this.rebornTime&&(this.posX=this.spawnPosX,this.posY=this.spawnPosY,this.killed=!1,this.material=!0,this.visible=!0,t.removable=!0)},a.kill=function(){this.killed=!0,this.material=!1,this.visible=!1,this.moves=!1;var e=new Date;0<this.hp&&(this.hp-=1),0<this.hp&&(this.rebornCounter=this.rebornTime,this.addEventToStart("reborn",function(){a.reborn(e,this)},!1,!0))}.bind(a),a.upScore=function(e){this.score+=e}.bind(a),a.clash=function(e){"coin"===e.type&&this.upScore(1)}.bind(a),a.control=function(e){if(!this.killed)switch(e){case"up":this.changeDirection("top"),this.startMove();break;case"right":this.changeDirection("right"),this.startMove();break;case"down":this.changeDirection("bottom"),this.startMove();break;case"left":this.changeDirection("left"),this.startMove();break;case"stop":this.stopMove()}}.bind(a),a}function xt(e,t,n){var i=new _t(e,"stone",ze,!0,t,n);return i.spriteWidth=40,i.spriteHeight=52,i.spriteOffsetY=-6,i.stoneSprites={isolated:ze,connectedLeft:Te,connectedRight:Re,connectedTop:He,connectedBottom:Be,betweenHorizontal:Fe,betweenVertical:De,connectedBottomAndRight:Me,connectedBottomAndLeft:We,connectedTopAndLeft:Ve,connectedTopAndRight:$e,connectedAll:qe,betweenVerticalConnectedRight:Ke,betweenVerticalConnectedLeft:Ne,betweenHorizontalConnectedBottom:Je,betweenHorizontalConnectedTop:Ue},i.setSprite=function(e){this.stoneSprites[e]&&(this.sprite=this.stoneSprites[e])}.bind(i),i}function It(e,t,n){var i=new _t(e,"coin",new Pt([dt,ut,mt,bt,gt,vt]),!0,t,n);return i.spriteWidth=25,i.spriteHeight=28,i.spriteOffsetY=-15,i.animateSpeed=2,i.clash=function(e){if("player"===e.type){var t=new Audio;t.src=Xe.a,t.volume=.005,t.play(),this.die()}}.bind(i),i}function jt(e,t,n,i){var s=new _t(e,"trap",new Pt([wt,yt,St,Ct,St,yt]),!0,t,n);return s.active=!1,s.animateSpeed=1,s.staticAnimate=function(){s.active=3===this.animateSpriteCount||2===this.animateSpriteCount,0===this.animateSpriteCount||3===this.animateSpriteCount?this.animateSpeedCount===this.animateSpeed*i?(this.animateSpriteCount+=1,this.animateSpeedCount=0):this.animateSpeedCount+=1:this.animateSpeedCount===this.animateSpeed?(this.animateSpeedCount=0,this.animateSpriteCount===this.spriteList.length-1?this.animateSpriteCount=0:this.animateSpriteCount+=1,this.sprite=this.spriteList.getSprite(this.animateSpriteCount,this.direction)):this.animateSpeedCount+=1}.bind(s),s.addEvent("staticAnimate",s.staticAnimate,!1,!0),s.clash=function(e){this.active&&"player"===e.type&&e.kill()}.bind(s),s}Ct.src=Ye.a;var Ot=function(){function a(e,t,n,i,s){Ee(this,a),this.id="cell"+e,this.posX=t,this.posY=n,this.objects=[],this.sprite=Qe,this.visible=!0,this.fieldPosRow=i,this.fieldPosColumn=s}return Ge(a,[{key:"set",value:function(e){this.objects.push(e),e.posX=this.posX,e.posY=this.posY,"player"===e.type&&(e.spawnPosX=this.posX,e.spawnPosY=this.posY)}},{key:"clear",value:function(e){e&&this.objects.forEach(function(e){e.die()}),this.objects=[]}}]),a}(),Yt=function e(t,n,i){Ee(this,e),this.id="event"+t,this.func=n,this.removable=void 0===i||i},Pt=function(){function t(e){Ee(this,t),e.length?(this.default=e,this.length=e.length):(this.right=e.right,this.left=e.left,e.stop&&(this.stop={right:e.stop.right,left:e.stop.left}),this.length=e.left.length),this.lastDirection="right"}return Ge(t,[{key:"getStopSprite",value:function(e){return"right"===e?(this.lastDirection=e,this.stop.right):"left"===e?(this.lastDirection=e,this.stop.left):this.getStopSprite(this.lastDirection)}},{key:"getSprite",value:function(e,t){return t?"right"===t?(this.lastDirection=t,this.right[e]):"left"===t?(this.lastDirection=t,this.left[e]):this.getSprite(e,this.lastDirection):this.default[e]}}]),t}(),Xt=[new function e(t,n,i,s,a){Ee(this,e),this.stoneList=t,this.traps=n,this.playersFieldCoords=i,this.mobSpawnPoints=s,this.holesInBaseStones=a}([[1,5],[1,8],[1,9],[1,11],[1,13],[1,14],[1,17],[2,2],[2,3],[2,5],[2,7],[2,8],[2,11],[2,14],[2,15],[2,17],[2,19],[2,20],[3,2],[3,7],[3,8],[3,10],[3,11],[3,12],[3,14],[3,15],[3,20],[4,4],[4,5],[4,17],[4,18],[5,1],[5,7],[5,8],[5,9],[5,11],[5,13],[5,14],[5,15],[5,21],[6,3],[6,5],[6,9],[6,11],[6,13],[6,17],[6,19],[7,1],[7,2],[7,3],[7,5],[7,6],[7,11],[7,16],[7,17],[7,19],[7,20],[7,21],[8,8],[8,9],[8,10],[8,11],[8,12],[8,13],[8,14],[9,1],[9,2],[9,3],[9,5],[9,6],[9,16],[9,17],[9,19],[9,20],[9,21],[10,3],[10,5],[10,8],[10,10],[10,12],[10,14],[10,17],[10,19],[11,7],[11,8],[11,10],[11,12],[11,14],[11,15],[12,2],[12,4],[12,5],[12,17],[12,18],[12,20],[13,2],[13,4],[13,5],[13,7],[13,8],[13,10],[13,11],[13,12],[13,14],[13,15],[13,17],[13,18],[13,20],[14,2],[14,4],[14,5],[14,7],[14,10],[14,11],[14,12],[14,15],[14,17],[14,18],[14,20],[15,7],[15,9],[15,10],[15,11],[15,12],[15,13],[15,15]],[[3,5],[3,17],[4,11],[8,5],[8,6],[8,16],[8,17],[10,11],[11,11],[13,3],[13,19]],[[1,1],[1,21]],[],[[8,0],[8,22]])],Et=n(0);function At(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Gt(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function zt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Tt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Rt(e,t,n){return t&&Tt(e.prototype,t),n&&Tt(e,n),e}var Ht=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$gameWindow=document.querySelector(".canvasWrapper"),this.$interface=document.querySelector(".interface"),this.$playerInfoBlocks=[]}return function(e,t,n){t&&At(e.prototype,t),n&&At(e,n)}(e,[{key:"gamePause",value:function(){this.$gameWindow.classList.toggle("pause")}},{key:"touchHandler",value:function(){}},{key:"setControls",value:function(t){document.addEventListener("keydown",function(e){return t(e)})}},{key:"createInterface",value:function(e){var o=this;e.players.forEach(function(e,t){var n=document.createElement("div"),i=document.createElement("span"),s=document.createElement("span"),a=new Image;n.className="player_info player_info--".concat(e.id),i.className="player_info__score",i.innerHTML="Score: <span class='score_value'>".concat(e.score,"</span>"),s.className="player_info__reborn_counter",s.innerHTML="Возродится через: <span class='reborn_counter__counter'>".concat(e.rebornCounter,"</span>"),a.src=e.sprite.src,n.append(a),n.append(i),n.append(s),o.$interface.append(n),o.$playerInfoBlocks.push(n)})}},{key:"interfaceReload",value:function(e){var a=this;e.players.forEach(function(t){var e=a.$playerInfoBlocks.find(function(e){return e.classList.contains("player_info--".concat(t.id))}),n=e.querySelector(".score_value"),i=e.querySelector(".player_info__reborn_counter"),s=i.querySelector(".reborn_counter__counter");n.textContent=t.score,0<t.rebornCounter?(i.classList.contains("active")||i.classList.add("active"),s.textContent=t.rebornCounter):(s.textContent=0,i.classList.contains("active")&&i.classList.remove("active"))})}}]),e}()),Bt=function(){function e(){zt(this,e),this.canvas=document.querySelector("#canvas"),this.ctx=this.canvas.getContext("2d"),this.windowWidth=this.canvas.clientWidth,this.windowHeight=this.canvas.clientHeight,this.cellSize=40,this.drawBackground()}return Rt(e,[{key:"drawObject",value:function(e){if(e.visible){var t=e.spriteWidth,n=e.spriteHeight,i=e.posX-this.cellSize/2,s=e.posY-this.cellSize/2;t&&n&&(i=e.posX-t/2,s=e.posY-n/2),e.spriteOffsetX&&(i+=e.spriteOffsetX),e.spriteOffsetY&&(s+=e.spriteOffsetY);try{this.ctx.drawImage(e.sprite,i,s,t||this.cellSize,n||this.cellSize)}catch(e){}}}},{key:"drawCell",value:function(e){e.object&&e.object.visible&&this.drawObject(e.object)}},{key:"drawBackground",value:function(){this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.windowWidth,this.windowHeight)}}]),e}();(new(function(){function t(e){zt(this,t),(window.Game=this).eventList=[],this.Graphic=new Bt,this.gameInterval=null,this.gameField=[],this.gameSpeed=30,this.paused=!1,this.stones=[],this.players=[],this.mobs=[],this.loot=[],this.traps=[],this.trapDuration=40,this.mapList=Xt,this.allObjects=[].concat(Gt(this.stones),Gt(this.players),Gt(this.mobs)),this.mapCreate(this.mapList[0]),this.setControls(),Ht.createInterface({players:this.players})}return Rt(t,[{key:"addObject",value:function(e,t){switch(t){case"stone":this.stones.push(e);break;case"player":this.players.push(e);break;case"mobs":this.mobs.push(e);break;case"loot":this.loot.push(e);break;case"trap":this.traps.push(e)}this.allObjects.push(e)}},{key:"removeObject",value:function(t){switch(this.allObjects=this.allObjects.filter(function(e){return e.id!==t.id}),t.type){case"stone":this.stones=this.stones.filter(function(e){return e.id!==t.id}),this.stonePositionAnalyse();break;case"player":this.players=this.players.filter(function(e){return e.id!==t.id});break;case"mob":this.mobs=this.mobs.filter(function(e){return e.id!==t.id});break;case"loot":this.loot=this.loot.filter(function(e){return e.id!==t.id});break;case"trap":this.traps=this.traps.filter(function(e){return e.id!==t.id});break;default:this.loot=this.loot.filter(function(e){return e.id!==t.id})}}},{key:"setControls",value:function(){var s=this;Ht.setControls(function(e){var t=Et.player1,n=Et.player2,i=Et.global;if(!s.paused)switch(e.code){case t.up:s.players[0].control("up");break;case t.right:s.players[0].control("right");break;case t.down:s.players[0].control("down");break;case t.left:s.players[0].control("left");break;case t.stop:s.players[0].control("stop");break;case n.up:s.players[1].control("up");break;case n.right:s.players[1].control("right");break;case n.down:s.players[1].control("down");break;case n.left:s.players[1].control("left");break;case n.stop:s.players[1].control("stop")}e.code===i.pause&&(s.paused?(s.start(),s.paused=!1):(s.pause(),s.paused=!0),Ht.gamePause())})}},{key:"findCell",value:function(t){var n,i,e,s=[];this.gameField.forEach(function(e){e.forEach(function(e){return s.push(e)})});var a=this.Graphic.cellSize/2;if(t.fieldPosRow&&t.fieldPosColumn)e=s.find(function(e){return e.fieldPosRow===t.fieldPosRow&&e.fieldPosColumn===t.fieldPosColumn});else if(t.posX&&t.posY)n=t.posX,i=t.posY,e=s.find(function(e){return e.posX-a<=n&&e.posX+a>=n&&e.posY-a<=i&&e.posY+a>=i});else if(t.object&&t.direction){n=t.object.posX,i=t.object.posY;var o=s.find(function(e){return e.posX-a<=n&&e.posX+a>=n&&e.posY-a<=i&&e.posY+a>=i});if(!o)return null;switch(t.direction){case"top":e=this.findCell({fieldPosRow:o.fieldPosRow-1,fieldPosColumn:o.fieldPosColumn});break;case"right":e=this.findCell({fieldPosRow:o.fieldPosRow,fieldPosColumn:o.fieldPosColumn+1});break;case"bottom":e=this.findCell({fieldPosRow:o.fieldPosRow+1,fieldPosColumn:o.fieldPosColumn});break;case"left":e=this.findCell({fieldPosRow:o.fieldPosRow,fieldPosColumn:o.fieldPosColumn-1})}}return e}},{key:"stonePositionAnalyse",value:function(){var s=function(e,t){return this.gameField[e]&&this.gameField[e][t]&&0<this.gameField[e][t].objects.length&&"stone"===this.gameField[e][t].objects[0].type}.bind(this);this.gameField.forEach(function(e,i){e.forEach(function(e,t){if(0<e.objects.length&&"stone"===e.objects[0].type){var n=e.objects[0];s(i-1,t)&&s(i+1,t)&&s(i,t-1)&&s(i,t+1)?n.setSprite("connectedAll"):s(i-1,t)&&s(i+1,t)&&s(i,t+1)?n.setSprite("betweenVerticalConnectedRight"):s(i-1,t)&&s(i+1,t)&&s(i,t-1)?n.setSprite("betweenVerticalConnectedLeft"):s(i,t-1)&&s(i,t+1)&&s(i+1,t)?n.setSprite("betweenHorizontalConnectedBottom"):s(i,t-1)&&s(i,t+1)&&s(i-1,t)?n.setSprite("betweenHorizontalConnectedTop"):s(i+1,t)&&s(i,t+1)?n.setSprite("connectedBottomAndRight"):s(i+1,t)&&s(i,t-1)?n.setSprite("connectedBottomAndLeft"):s(i-1,t)&&s(i,t+1)?n.setSprite("connectedTopAndRight"):s(i-1,t)&&s(i,t-1)?n.setSprite("connectedTopAndLeft"):s(i,t+1)&&s(i,t-1)?n.setSprite("betweenHorizontal"):s(i+1,t)&&s(i-1,t)?n.setSprite("betweenVertical"):s(i-1,t)?n.setSprite("connectedTop"):s(i,t-1)?n.setSprite("connectedLeft"):s(i+1,t)?n.setSprite("connectedBottom"):s(i,t+1)&&n.setSprite("connectedRight")}})})}},{key:"addStone",value:function(e,t,n){var i;i=n||new xt("".concat(e,"_").concat(t)),this.addObject(i,"stone"),this.gameField[e][t].set(i)}},{key:"addStones",value:function(e){var s=this;e.forEach(function(e){var t=e[0],n=e[1],i=new xt("".concat(t,"_").concat(n));s.addObject(i,"stone"),s.gameField[t][n].set(i)})}},{key:"mapCreate",value:function(e){for(var s=this,t=0;t<this.Graphic.windowHeight/this.Graphic.cellSize;t++){this.gameField[t]=[];for(var n=0;n<this.Graphic.windowWidth/this.Graphic.cellSize;n++)if(this.gameField[t][n]=new Ot("".concat(t,"_").concat(n),n*this.Graphic.cellSize+this.Graphic.cellSize/2,t*this.Graphic.cellSize+this.Graphic.cellSize/2,t,n),0===t||t===this.Graphic.windowHeight/this.Graphic.cellSize-1||0===n||n===this.Graphic.windowWidth/this.Graphic.cellSize-1){var i=new xt("".concat(t,"_").concat(n));0===t||t===this.Graphic.windowHeight/this.Graphic.cellSize-1?0<n&&n<this.Graphic.windowWidth/this.Graphic.cellSize-1?i.setSprite("betweenHorizontal"):0===n?0===t?i.setSprite("connectedBottomAndRight"):i.setSprite("connectedTopAndRight"):0===t?i.setSprite("connectedBottomAndLeft"):i.setSprite("connectedTopAndLeft"):i.setSprite("betweenVertical"),this.addObject(i,"stone"),this.gameField[t][n].set(i)}}this.addStones(e.stoneList),e.holesInBaseStones.forEach(function(e){s.gameField[e[0]][e[1]].clear(!0)}),e.traps.forEach(function(e){var t=new jt("".concat(e[0],"_").concat(e[1]),null,null,s.trapDuration);s.addObject(t,"trap"),s.gameField[e[0]][e[1]].set(t)}),e.playersFieldCoords.forEach(function(e,t){s.players[t]||(s.addObject(new Lt(t),"player"),s.gameField[e[0]][e[1]].set(s.players[t]))}),this.stonePositionAnalyse(),this.gameField.forEach(function(e,i){e.forEach(function(e,t){if(0===e.objects.length){var n=new It("".concat(i,"_").concat(t),e.posX,e.posY);s.addObject(n,"loot"),e.set(n)}})})}},{key:"drawFrame",value:function(){var t=this;this.gameField.forEach(function(e){return e.forEach(function(e){t.Graphic.drawObject(e)})}),this.allObjects=this.allObjects.sort(function(e,t){return e.posY-t.posY}),this.traps.forEach(function(e){return t.Graphic.drawObject(e)}),this.allObjects.forEach(function(e){"trap"!==e.type&&t.Graphic.drawObject(e)})}},{key:"checkOverflow",value:function(){var t=this;[].concat(Gt(this.mobs),Gt(this.players)).forEach(function(e){e.posX>t.Graphic.windowWidth+t.Graphic.cellSize?e.posX=0-t.Graphic.cellSize:e.posX<0-t.Graphic.cellSize?e.posX=t.Graphic.windowWidth+t.Graphic.cellSize:e.posY>t.Graphic.windowHeight+t.Graphic.cellSize?e.posY=0-t.Graphic.cellSize:e.posY<0-t.Graphic.cellSize&&(e.posY=t.Graphic.windowHeight+t.Graphic.cellSize)})}},{key:"checkClash",value:function(){var n=this,e=[].concat(Gt(this.mobs),Gt(this.players));this.allObjects.forEach(function(t){e.forEach(function(e){t.material&&e.material&&t.checkClash(e,n.Graphic.cellSize)})})}},{key:"gameLoop",value:function(){}},{key:"start",value:function(){var e=this;this.gameInterval=setInterval(function(){e.checkClash(),e.eventList.forEach(function(e){return e()}),e.eventList=[],e.allObjects.forEach(function(e){e.eventList&&0<e.eventList.length&&e.startEvents()}),e.checkOverflow(),e.drawFrame(),Ht.interfaceReload({players:e.players})},1/this.gameSpeed*1e3)}},{key:"pause",value:function(){clearInterval(this.gameInterval)}}]),t}())).start()}]);