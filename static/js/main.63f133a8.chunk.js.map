{"version":3,"sources":["contexts/connection.ts","contexts/messages.ts","hooks/useConnection.ts","components/GlobalContext.tsx","assets/bg.mp4","assets/bg.png","components/Bg/Bg.tsx","components/MessageLisst/MessagesList.tsx","hooks/useSocketRequests.ts","api/reuests.ts","components/MessageEditor/MessageEditor.tsx","components/Window/Window.tsx","components/MainSideBar/modules/UserList.tsx","components/MainSideBar/MainSideBar.tsx","components/MainWindow/MainWindow.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["SocketContext","React","createContext","undefined","connection","onMessage","socket","WebSocket","process","onmessage","onclose","event","console","log","setTimeout","newConnection","e","error","MessagesContext","useConnection","handlers","useState","setSocket","handleSocket","type","JSON","parse","data","useEffect","GlobalContext","children","messages","setMessages","message","prevState","Provider","value","Bg","props","src","imgBgSrc","className","videoSrc","autoPlay","loop","muted","width","height","MessagesList","messagesJSX","useContext","map","date","Date","owner","getHours","getMinutes","text","id","useSocketRequests","sendMessage","msg","action","send","stringify","sendMessageRequest","MessageEditor","messageText","setMessageText","handleSend","length","onKeyDown","code","preventDefault","onChange","target","name","cols","rows","onClick","Window","sideBar","controls","containerClassName","toolbar","mockedData","userName","UserList","users","sort","u1","window","innerWidth","windowWidth","setWindowWidth","listener","currentTarget","addEventListener","removeEventListener","user","toUpperCase","MainSideBar","MainWindow","App","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.63f133a8.chunk.js","sourcesContent":["import React from \"react\";\r\n\r\ntype SocketContextType = {\r\n  socket: WebSocket;\r\n}\r\n\r\nexport const SocketContext = React.createContext<SocketContextType>(undefined!);\r\n\r\nexport const connection = (onMessage: (event: any) => void): WebSocket | null => {\r\n  try {\r\n    const socket = new WebSocket(process.env.REACT_APP_SOCKET_URL!);\r\n\r\n    socket.onmessage = onMessage;\r\n\r\n    socket.onclose = (event) => {\r\n      console.log('Socket closed by event:', event);\r\n\r\n      console.log('Trying to reconnect...');\r\n      setTimeout(() => {\r\n        try {\r\n          const newConnection = connection(onMessage);\r\n\r\n          console.log('Successfully reconnected: ', newConnection);\r\n        } catch (e) {\r\n          console.error(\"Error of reconnection: \", e);\r\n        }\r\n      }, 1000);\r\n    }\r\n\r\n    console.log('Successfully websocket connection:', socket);\r\n    return socket;\r\n  } catch (e) {\r\n    console.log('Something went wrong while websocket connection: ', e);\r\n    // TODO: implement global API Error\r\n    return null;\r\n  }\r\n}","import React  from \"react\";\r\nimport { Message } from \"../Models/Message\";\r\n\r\ntype MessagesContextType = {\r\n  messages: Message[];\r\n}\r\n\r\nexport const MessagesContext = React.createContext<MessagesContextType>(undefined!);\r\n","import { useEffect, useState } from 'react';\r\n\r\nimport { connection } from '../contexts/connection';\r\n\r\n// TODO: Moved request typing to backend\r\ntype RequestsTypes = 'message';\r\n\r\ntype Handlers = {\r\n  [key in RequestsTypes]?: (data: any) => void;\r\n}\r\n\r\ntype EventType = {\r\n  type: RequestsTypes,\r\n  data: any\r\n}\r\n\r\nconst useConnection = (handlers: Handlers) => {\r\n  const [socket, setSocket] = useState<WebSocket | null>(null);\r\n\r\n  const handleSocket = (event: EventType) => {\r\n    if (event.type in handlers) {\r\n      handlers[event.type]!(JSON.parse(event.data));\r\n    } else {\r\n      console.error(`Unhandled socket event type {${event.type}}:`, event);\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    setSocket(connection(handleSocket));\r\n  }, []);\r\n\r\n  return socket;\r\n};\r\n\r\nexport default useConnection;","import React, { FunctionComponent, useState } from 'react';\n\nimport { SocketContext } from '../contexts/connection';\nimport { MessagesContext } from '../contexts/messages';\nimport useConnection from '../hooks/useConnection';\nimport { Message } from '../Models/Message';\n\nconst GlobalContext: FunctionComponent = ({ children }) => {\n  const [messages, setMessages] = useState<Message[]>([]);\n\n  const onMessage = (data: Message) => {\n    console.log('Received message:', data);\n    setMessages((prevState) => [...prevState, data]);\n  };\n\n  const socket = useConnection({\n    message: onMessage,\n  });\n\n  if (!socket) {\n    return <>Loading...</>;\n  }\n\n  return (\n    <SocketContext.Provider value={{ socket: socket }}>\n      <MessagesContext.Provider value={{ messages }}>\n        {children}\n      </MessagesContext.Provider>\n    </SocketContext.Provider>\n  );\n};\n\nexport default GlobalContext;\n","export default __webpack_public_path__ + \"static/media/bg.30eec6b5.mp4\";","export default __webpack_public_path__ + \"static/media/bg.6771a782.png\";","import React, { FunctionComponent } from 'react';\r\nimport './Bg.css';\r\n//@ts-ignore\r\nimport videoSrc from '../../assets/bg.mp4';\r\nimport imgBgSrc from '../../assets/bg.png';\r\n\r\ntype BgProps = {\r\n\r\n}\r\n\r\nconst Bg: FunctionComponent<BgProps> = (props) => {\r\n  return <>\r\n    <img\r\n      src={imgBgSrc}\r\n      className=\"static_bg\"\r\n    />\r\n    <video\r\n      className=\"live_bg\"\r\n      src={videoSrc}\r\n      autoPlay={true}\r\n      loop={true}\r\n      muted={true}\r\n      width=\"100%\"\r\n      height=\"100%\"\r\n    />\r\n  </>;\r\n}\r\n\r\nexport default Bg;\r\n","import React, { FunctionComponent, useContext } from 'react';\nimport { MessagesContext } from '../../contexts/messages';\nimport './MessageList.css';\n\ntype MessagesListProps = {};\n\nconst MessagesList: FunctionComponent<MessagesListProps> = (props) => {\n  const { messages } = useContext(MessagesContext);\n\n  const messagesJSX = messages.map(message => {\n    const date = new Date(message.date);\n\n    return (\n      <li className={`${message?.owner ? 'my' : '' }`} key={message.id} >\n        <span className={\"message__time\"} >{date.getHours()}:{date.getMinutes()}</span>\n        { message.text }\n      </li>\n    )\n  })\n\n  return <ul className=\"messages_list\">{\n    messagesJSX\n  }</ul>;\n};\n\nexport default MessagesList;\n","import { useContext } from 'react';\r\n\r\nimport { SocketContext } from '../contexts/connection';\r\nimport { sendMessage as sendMessageRequest } from '../api/reuests';\r\n\r\nconst useSocketRequests = () => {\r\n  const { socket } = useContext(SocketContext);\r\n\r\n  const sendMessage = (message: string) => {\r\n    sendMessageRequest(socket, { message });\r\n  }\r\n\r\n  return {\r\n    sendMessage\r\n  }\r\n}\r\n\r\nexport default useSocketRequests;","import { Message } from '@webchat_test/messages';\n\ntype SocketRequest<Data> = (socket: WebSocket, data: Data) => unknown;\n\nexport const sendMessage: SocketRequest<{ message: Message['text'] }> = (\n  socket: WebSocket,\n  { message }\n) => {\n  const msg = {\n    action: 'sendmessage',\n    text: message,\n  };\n\n  socket.send(JSON.stringify(msg));\n};\n","import React, { ChangeEvent, FunctionComponent, useState } from 'react';\r\nimport useSocketRequests from \"../../hooks/useSocketRequests\";\r\nimport './MessageEditor.css';\r\n\r\ntype MessageEditorProps = {\r\n\r\n}\r\n\r\nconst MessageEditor: FunctionComponent<MessageEditorProps> = (props) => {\r\n  const [messageText, setMessageText] = useState('');\r\n  const { sendMessage } = useSocketRequests();\r\n\r\n  const validation = () => {\r\n    if (messageText.length <= 0) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  const handleChange = (e: ChangeEvent<HTMLTextAreaElement>) => {\r\n    setMessageText(e.target.value);\r\n  }\r\n\r\n  const handleSend = () => {\r\n    if (validation()) {\r\n      setMessageText('');\r\n      sendMessage(messageText);\r\n    }\r\n  }\r\n\r\n  const handleKey = (event: any) => {\r\n    if (event.code === 'Enter') {\r\n      handleSend();\r\n      event.preventDefault();\r\n    }\r\n  }\r\n\r\n  return <div className={'message_editor_container'}>\r\n    <textarea\r\n      onKeyDown={handleKey}\r\n      value={messageText}\r\n      onChange={handleChange}\r\n      name=\"msg_editor\"\r\n      id=\"msg_editor_textarea\"\r\n      cols={5}\r\n      rows={10}\r\n    />\r\n    <button onClick={handleSend} className=\"message_editor__send_button\" />\r\n  </div>;\r\n}\r\n\r\nexport default MessageEditor;\r\n","import React, { CSSProperties, FunctionComponent } from 'react';\r\nimport './Window.css';\r\n\r\ntype WindowProps = {\r\n  controls?: boolean;\r\n  toolbar?: React.ReactNode;\r\n  sideBar?: React.ReactNode;\r\n  className?: string\r\n  width?: CSSProperties['width'],\r\n  height?: CSSProperties['height'],\r\n  containerClassName?: string\r\n  children: React.ReactNode;\r\n}\r\n\r\nconst Window: FunctionComponent<WindowProps> = (props) => {\r\n  const {\r\n    className,\r\n    children,\r\n    sideBar,\r\n    containerClassName,\r\n    controls,\r\n    toolbar\r\n  } = props;\r\n\r\n  return <div className={`window ${className || ''}`}>\r\n    <div className=\"window__header\">\r\n      <div className=\"window_header__container\">\r\n        { controls && <div className=\"window__controls\" />}\r\n        { toolbar || null }\r\n      </div>\r\n    </div>\r\n    <div className='window__inner' >\r\n      { sideBar && (\r\n        <div className=\"window__sidebar\">\r\n          {sideBar}\r\n        </div>\r\n      )}\r\n      <div className=\"window__content\">\r\n        {children}\r\n      </div>\r\n    </div>\r\n  </div>;\r\n}\r\n\r\nexport default Window;\r\n","import React, { FunctionComponent, useEffect, useState } from 'react';\r\nimport './UserList.css';\r\n\r\ntype UserListProps = {\r\n\r\n}\r\n\r\n// TODO: remove mocks\r\nconst mockedData = [\r\n  {\r\n    id: 'someid',\r\n    userName: 'Username'\r\n  },\r\n  {\r\n    id: 'someid23',\r\n    userName: 'Vladimir',\r\n    owner: true\r\n  }\r\n];\r\n\r\nconst UserList: FunctionComponent<UserListProps> = (props) => {\r\n  const users = mockedData.sort(u1 => !u1.owner && 1 || -1);\r\n  const [windowWidth, setWindowWidth] = useState(window.innerWidth);\r\n\r\n  useEffect(() => {\r\n    const listener = (event: UIEvent) => {\r\n      setWindowWidth((event.currentTarget! as Window).innerWidth);\r\n    }\r\n    window.addEventListener('resize', listener);\r\n\r\n    return () => window.removeEventListener('resize', listener);\r\n  }, []);\r\n\r\n  return (\r\n    <ul className={`main_sidebar__user_list ${windowWidth < 600 ? 'min' : ''}`}>\r\n      { users.map(user => (\r\n        <li key={user.id} className={`user_list__user ${user.owner ? 'my' : ''}`} >\r\n          <div className=\"user__avatar\"><span>{user.userName[0].toUpperCase()}</span></div>\r\n          <span className=\"user__name\">{ user.userName }</span>\r\n        </li>\r\n      ))}\r\n    </ul>\r\n  );\r\n}\r\n\r\nexport default UserList;\r\n","import React, { FunctionComponent } from 'react';\r\nimport './MainSideBar.css';\r\nimport UserList from \"./modules/UserList\";\r\n\r\ntype MainSideBarProps = {\r\n\r\n}\r\n\r\nconst MainSideBar: FunctionComponent<MainSideBarProps> = (props) => {\r\n\r\n  return <div className=\"main_sidebar\" >\r\n    <div className=\"main_sidebar__inner main_sidebar__container\">\r\n      <h3 className=\"main_sidebar__title\" >Users</h3>\r\n      <UserList />\r\n    </div>\r\n  </div>;\r\n}\r\n\r\nexport default MainSideBar;\r\n","import React, { FunctionComponent } from 'react';\r\nimport MessagesList from \"../MessageLisst/MessagesList\";\r\nimport MessageEditor from \"../MessageEditor/MessageEditor\";\r\nimport Window from \"../Window/Window\";\r\nimport './MainWindow.css';\r\nimport MainSideBar from \"../MainSideBar/MainSideBar\";\r\n\r\ntype MainWindowProps = {\r\n\r\n}\r\n\r\nconst MainWindow: FunctionComponent<MainWindowProps> = (props) => {\r\n  return (\r\n    <Window\r\n      className={'main_window'}\r\n      controls\r\n      sideBar={<MainSideBar />}\r\n    >\r\n      <div className=\"main_window__container\">\r\n        <MessagesList />\r\n        <MessageEditor/>\r\n      </div>\r\n    </Window>\r\n  );\r\n}\r\n\r\nexport default MainWindow;\r\n","import React from 'react';\nimport './App.css';\nimport GlobalContext from \"./components/GlobalContext\";\nimport Bg from \"./components/Bg/Bg\";\nimport MainWindow from \"./components/MainWindow/MainWindow\";\n\nfunction App() {\n  return (\n    <GlobalContext>\n      <div className=\"App\">\n        <Bg />\n        <div className=\"app__container\">\n          <MainWindow />\n        </div>\n      </div>\n    </GlobalContext>\n  );\n}\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}